# MonitorControllerMax ç¨³å®šæ€§æ¶æ„é‡æ„æ–¹æ¡ˆ v3.0
**å·¥ç¨‹çº§ç¨³å®šæ€§é‡æ„ - ç®€æ´è®¾è®¡ï¼Œç»å¯¹ç¨³å®š**

## ğŸ¯ é‡æ„ç›®æ ‡ä¸ç°çŠ¶åˆ†æ

### å½“å‰é—®é¢˜çŠ¶æ€ (2025-07-31)
æ’ä»¶å½“å‰å¤„äº**åŠé‡æ„çŠ¶æ€**ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

**ğŸš¨ æ ¸å¿ƒé—®é¢˜**ï¼š
1. **StateManageré”™è¯¯å®ç°** - ç›‘å¬ä¸å­˜åœ¨çš„VST3å‚æ•°ï¼Œå¯¼è‡´Solo/MuteéŸ³é¢‘å¤„ç†å¤±æ•ˆ
2. **éŸ³é¢‘çº¿ç¨‹ä¸å®‰å…¨** - processBlockä¸­å­˜åœ¨é”æ“ä½œå’Œå¤æ‚è®¡ç®—ï¼Œè¿åJUCEè§„èŒƒ
3. **æ¶æ„èŒè´£æ··ä¹±** - StateManagerä¸SemanticChannelStateèŒè´£é‡å å†²çª

**âœ… å·¥ä½œæ­£å¸¸çš„éƒ¨åˆ†**ï¼š
- SemanticChannelState - Solo/Muteå¤æ‚ä¸šåŠ¡é€»è¾‘å®Œæ•´ä¸”æ­£ç¡®
- MasterBusProcessor - æ€»çº¿æ•ˆæœå¤„ç†ç¨³å®šå·¥ä½œ
- GlobalPluginState - Master-Slaveé€šä¿¡æ­£å¸¸
- OSCCommunicator - å¤–éƒ¨æ§åˆ¶é€šä¿¡æ­£å¸¸ï¼ˆæ—¥å¿—æ˜¾ç¤ºDim/Volumeæ§åˆ¶å·¥ä½œï¼‰
- ConfigManager - å¸ƒå±€é…ç½®ç®¡ç†ç¨³å®š

### é‡æ„ç›®æ ‡
- **é›¶å´©æºƒä¿è¯** - ä¸¥æ ¼éµå¾ªJUCEéŸ³é¢‘çº¿ç¨‹è§„èŒƒï¼Œæ¶ˆé™¤æ‰€æœ‰æ½œåœ¨å´©æºƒç‚¹
- **æ€§èƒ½å¤§å¹…æå‡** - éŸ³é¢‘å»¶è¿Ÿé™ä½95%ï¼ŒCPUä½¿ç”¨ç‡é™ä½80%
- **ä¿æŒæ‰€æœ‰ç°æœ‰é€»è¾‘** - ç”¨æˆ·ä½“éªŒ100%ä¸å˜ï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘å®Œå…¨ä¿æŒ
- **æ¶æ„æ¸…æ™°ç®€æ´** - èŒè´£æ˜ç¡®ï¼Œåç§°ç›´è§‚ï¼Œæ˜“äºç»´æŠ¤

## ğŸ—ï¸ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### JUCE éŸ³é¢‘çº¿ç¨‹å®‰å…¨è§„èŒƒ (ä¸¥æ ¼éµå¾ª)

**éŸ³é¢‘çº¿ç¨‹ç¦æ­¢æ“ä½œ**ï¼š
- âŒ å†…å­˜åˆ†é…/é‡Šæ”¾ï¼ˆnew/delete, std::stringæ„é€ ï¼‰
- âŒ é”æ“ä½œï¼ˆmutex, ReadWriteLock, juce::ScopedWriteLockï¼‰
- âŒ æ–‡ä»¶I/Oã€JSONè§£æã€å¤æ‚ç®—æ³•è®¡ç®—
- âŒ VST3_DBGç­‰å¯èƒ½è§¦å‘å­—ç¬¦ä¸²åˆ†é…çš„è°ƒè¯•è¾“å‡º

**éŸ³é¢‘çº¿ç¨‹å…è®¸æ“ä½œ**ï¼š
- âœ… ç®€å•ç®—æœ¯è¿ç®—ã€æ•°ç»„è®¿é—®ã€åŸå­å˜é‡è¯»å–
- âœ… é¢„åˆ†é…ç¼“å†²åŒºæ“ä½œï¼ˆbuffer.clear(), buffer.applyGain()ï¼‰
- âœ… æ ˆå˜é‡æ“ä½œã€æ¡ä»¶åˆ†æ”¯

**è®¾è®¡æ ¸å¿ƒï¼šé¢„è®¡ç®— + å¿«ç…§åº”ç”¨**
- æ‰€æœ‰å¤æ‚é€»è¾‘åœ¨æ¶ˆæ¯çº¿ç¨‹é¢„è®¡ç®—å®Œæˆ
- éŸ³é¢‘çº¿ç¨‹åªåšç®€å•çš„æ•°æ®åº”ç”¨ï¼Œé›¶é”é›¶åˆ†é…

## ğŸ›ï¸ ç®€åŒ–æ¶æ„è®¾è®¡

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·ç•Œé¢å±‚ (UI Thread)                       â”‚
â”‚  PluginEditor, SemanticChannelButton, EffectsPanel          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ ç”¨æˆ·äº‹ä»¶
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ä¸šåŠ¡é€»è¾‘å±‚ (Message Thread) [ä¿æŒä¸å˜]          â”‚
â”‚  SemanticChannelState, MasterBusProcessor, ConfigManager    â”‚
â”‚  è´Ÿè´£ï¼šæ‰€æœ‰å¤æ‚Solo/Muteé€»è¾‘ã€æ€»çº¿æ•ˆæœã€å¸ƒå±€ç®¡ç†              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ çŠ¶æ€å˜åŒ–é€šçŸ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 çŠ¶æ€å¿«ç…§å±‚ (Message Thread) [æ–°å¢]           â”‚
â”‚  StateManager - æ”¶é›†å„ç»„ä»¶æœ€ç»ˆçŠ¶æ€ï¼Œç”ŸæˆRenderStateå¿«ç…§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ åŒç¼“å†²åŸå­åˆ‡æ¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 éŸ³é¢‘å¤„ç†å±‚ (Audio Thread) [æç®€åŒ–]           â”‚
â”‚  processBlock - å•æ¬¡åŸå­è¯»å– + ç›´æ¥åº”ç”¨RenderState          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡å“²å­¦ï¼š**æœ€å°æ”¹åŠ¨ï¼Œæœ€å¤§ç¨³å®šæ€§**

**ä¿æŒç°æœ‰ç»„ä»¶100%ä¸å˜**ï¼š
- âœ… SemanticChannelState - ä¿æŒæ‰€æœ‰å¤æ‚SUBé€šé“é€»è¾‘
- âœ… MasterBusProcessor - ä¿æŒæ‰€æœ‰æ€»çº¿æ•ˆæœå¤„ç†
- âœ… GlobalPluginState - ä¿æŒMaster-Slaveé€šä¿¡æœºåˆ¶
- âœ… OSCCommunicator - ä¿æŒå¤–éƒ¨æ§åˆ¶åè®®

**åªæ·»åŠ 2ä¸ªç®€æ´ç»„ä»¶**ï¼š
- ğŸ†• StateManager - çŠ¶æ€æ”¶é›†å™¨ï¼ˆæ›¿ä»£é”™è¯¯çš„æ—§StateManagerï¼‰
- ğŸ†• RenderState - éŸ³é¢‘å¿«ç…§æ•°æ®ï¼ˆç®€å•PODç»“æ„ï¼‰

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. RenderState - éŸ³é¢‘å¿«ç…§æ•°æ®

```cpp
//==============================================================================
/**
 * éŸ³é¢‘æ¸²æŸ“çŠ¶æ€å¿«ç…§ - éŸ³é¢‘çº¿ç¨‹ä¸“ç”¨çš„é¢„è®¡ç®—æ•°æ®
 * ç‰¹ç‚¹ï¼šPODç»“æ„ã€æ— é”è®¿é—®ã€æ‰€æœ‰æ•°æ®é¢„è®¡ç®—å®Œæˆ
 */
struct RenderState
{
    static constexpr int MAX_CHANNELS = 26;
    
    //=== é€šé“æœ€ç»ˆçŠ¶æ€ï¼ˆç›´æ¥æ¥è‡ªSemanticChannelState::getFinalMuteStateï¼‰===
    bool channelShouldMute[MAX_CHANNELS];      // æœ€ç»ˆé™éŸ³çŠ¶æ€ï¼ˆåŒ…å«æ‰€æœ‰SUBé€»è¾‘ï¼‰
    float channelFinalGain[MAX_CHANNELS];      // æœ€ç»ˆå¢ç›Šï¼ˆä¸ªäººå¢ç›Š + è§’è‰²å¤„ç†ï¼‰
    bool channelIsActive[MAX_CHANNELS];        // é€šé“æ˜¯å¦åœ¨å½“å‰å¸ƒå±€ä¸­æ¿€æ´»
    
    //=== Masteræ€»çº¿æœ€ç»ˆçŠ¶æ€ï¼ˆç›´æ¥æ¥è‡ªMasterBusProcessorï¼‰===
    float masterGainFactor;                   // Masterå¢ç›Šå› å­
    float dimFactor;                           // Dimè¡°å‡å› å­ï¼ˆ1.0æˆ–0.16ï¼‰
    bool masterMuteActive;                     // Masteré™éŸ³
    bool monoActive;                           // Monoæ•ˆæœ
    
    //=== Monoæ•ˆæœé¢„è®¡ç®—æ•°æ® ===
    uint8_t monoChannelCount;                  // å‚ä¸Monoçš„é€šé“æ•°é‡
    uint8_t monoChannelIndices[MAX_CHANNELS];  // å‚ä¸Monoçš„é€šé“ç´¢å¼•è¡¨
    
    //=== æ•°æ®ç‰ˆæœ¬ï¼ˆABAé—®é¢˜é˜²æŠ¤ï¼‰===
    std::atomic<uint64_t> version{0};
    
    //=== éŸ³é¢‘å¤„ç†æ–¹æ³•ï¼ˆé«˜åº¦ä¼˜åŒ–ï¼Œå†…è”ï¼‰===
    void applyToBuffer(juce::AudioBuffer<float>& buffer, int numSamples) const noexcept
    {
        const int numChannels = juce::jmin(buffer.getNumChannels(), MAX_CHANNELS);
        
        // Master Muteå¿«é€Ÿè·¯å¾„
        if (masterMuteActive) {
            buffer.clear();
            return;
        }
        
        // Monoæ•ˆæœå¤„ç†
        if (monoActive && monoChannelCount > 1) {
            applyMonoEffect(buffer, numSamples);
        }
        
        // é€šé“å¤„ç†ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨å‘é‡åŒ–å‹å¥½ï¼‰
        for (int ch = 0; ch < numChannels; ++ch) {
            if (!channelIsActive[ch]) continue;
            
            if (channelShouldMute[ch]) {
                buffer.clear(ch, 0, numSamples);
            } else {
                const float totalGain = channelFinalGain[ch] * masterGainFactor * dimFactor;
                if (std::abs(totalGain - 1.0f) > 0.001f) {
                    buffer.applyGain(ch, 0, numSamples, totalGain);
                }
            }
        }
    }
    
private:
    void applyMonoEffect(juce::AudioBuffer<float>& buffer, int numSamples) const noexcept
    {
        // ä½¿ç”¨æ ˆåˆ†é…ä¸´æ—¶ç¼“å†²åŒºè¿›è¡ŒMonoæ··åˆ
        constexpr int BLOCK_SIZE = 64;
        for (int offset = 0; offset < numSamples; offset += BLOCK_SIZE) {
            const int samplesToProcess = juce::jmin(BLOCK_SIZE, numSamples - offset);
            
            // æ ˆåˆ†é…æ··åˆç¼“å†²åŒº
            alignas(16) float monoSum[BLOCK_SIZE] = {};
            
            // ç´¯åŠ æ‰€æœ‰Monoé€šé“
            for (int i = 0; i < monoChannelCount; ++i) {
                const int chIndex = monoChannelIndices[i];
                if (chIndex < buffer.getNumChannels()) {
                    const float* src = buffer.getReadPointer(chIndex) + offset;
                    for (int s = 0; s < samplesToProcess; ++s) {
                        monoSum[s] += src[s];
                    }
                }
            }
            
            // è®¡ç®—å¹³å‡å€¼å¹¶å†™å›æ‰€æœ‰Monoé€šé“
            const float scale = 1.0f / float(monoChannelCount);
            for (int i = 0; i < monoChannelCount; ++i) {
                const int chIndex = monoChannelIndices[i];
                if (chIndex < buffer.getNumChannels()) {
                    float* dst = buffer.getWritePointer(chIndex) + offset;
                    for (int s = 0; s < samplesToProcess; ++s) {
                        dst[s] = monoSum[s] * scale;
                    }
                }
            }
        }
    }
};
```

### 2. StateManager - çŠ¶æ€æ”¶é›†åè°ƒå™¨

```cpp
//==============================================================================
/**
 * çŠ¶æ€ç®¡ç†å™¨ - æ”¶é›†å„ç»„ä»¶çŠ¶æ€ï¼Œç”ŸæˆéŸ³é¢‘å¿«ç…§
 * èŒè´£ï¼šä½œä¸ºå„ç»„ä»¶çš„çŠ¶æ€æ”¶é›†å™¨ï¼Œä¸åšä»»ä½•ä¸šåŠ¡é€»è¾‘è®¡ç®—
 * çº¿ç¨‹ï¼šä»…åœ¨æ¶ˆæ¯çº¿ç¨‹ä¸­è®¿é—®
 */
class StateManager : public SemanticChannelState::StateChangeListener,
                     public juce::AudioProcessorValueTreeState::Listener
{
public:
    StateManager(MonitorControllerMaxAudioProcessor& processor);
    ~StateManager();
    
    //=== åˆå§‹åŒ–ä¸å…³é—­ ===
    void initialize();
    void shutdown();
    
    //=== éŸ³é¢‘çº¿ç¨‹æ¥å£ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰===
    const RenderState* getCurrentRenderState() const noexcept;
    
    //=== SemanticChannelState::StateChangeListener æ¥å£ ===
    void onSoloStateChanged(const juce::String& channelName, bool state) override;
    void onMuteStateChanged(const juce::String& channelName, bool state) override;
    void onGlobalModeChanged() override;
    
    //=== AudioProcessorValueTreeState::Listener æ¥å£ ===
    void parameterChanged(const juce::String& parameterID, float newValue) override;
    
    //=== å¸ƒå±€å˜åŒ–å¤„ç† ===
    void onLayoutChanged();
    
private:
    MonitorControllerMaxAudioProcessor& processor;
    
    //=== åŒç¼“å†²ç³»ç»Ÿ ===
    std::unique_ptr<RenderState> renderStateA;
    std::unique_ptr<RenderState> renderStateB;
    std::atomic<RenderState*> activeRenderState{nullptr};    // éŸ³é¢‘çº¿ç¨‹è¯»å–
    RenderState* inactiveRenderState{nullptr};               // æ¶ˆæ¯çº¿ç¨‹æ›´æ–°
    
    //=== æ ¸å¿ƒæ–¹æ³• ===
    void collectCurrentState(RenderState* targetState);
    void commitRenderState();
    
    //=== çŠ¶æ€æ”¶é›†æ–¹æ³•ï¼ˆç›´æ¥è°ƒç”¨ç°æœ‰ç»„ä»¶ï¼Œä¸åšè®¡ç®—ï¼‰===
    void collectChannelStates(RenderState* target);
    void collectMasterBusStates(RenderState* target);
    void collectMonoChannelData(RenderState* target);
    
    JUCE_DECLARE_NON_COPYABLE_WITH_LEAK_DETECTOR(StateManager)
};

//==============================================================================
// æ ¸å¿ƒå®ç°ï¼šçŠ¶æ€æ”¶é›†å™¨
void StateManager::collectCurrentState(RenderState* targetState)
{
    // æ”¶é›†é€šé“çŠ¶æ€ï¼ˆç›´æ¥è°ƒç”¨ç°æœ‰é€»è¾‘ï¼Œé›¶è®¡ç®—ï¼‰
    collectChannelStates(targetState);
    
    // æ”¶é›†Masteræ€»çº¿çŠ¶æ€ï¼ˆç›´æ¥è°ƒç”¨ç°æœ‰é€»è¾‘ï¼‰
    collectMasterBusStates(targetState);
    
    // æ”¶é›†Monoæ•ˆæœæ•°æ®
    collectMonoChannelData(targetState);
    
    // æ›´æ–°ç‰ˆæœ¬å·
    targetState->version.store(targetState->version.load() + 1);
}

void StateManager::collectChannelStates(RenderState* target)
{
    const auto& currentLayout = processor.getCurrentLayout();
    
    for (const auto& channelInfo : currentLayout.channels) {
        const int physicalIndex = channelInfo.channelIndex;
        if (physicalIndex < 0 || physicalIndex >= RenderState::MAX_CHANNELS) continue;
        
        const String& channelName = channelInfo.name;
        
        // ç›´æ¥è°ƒç”¨SemanticChannelStateçš„æœ€ç»ˆç»“æœï¼ˆä¿æŒæ‰€æœ‰SUBé€»è¾‘ï¼‰
        target->channelShouldMute[physicalIndex] = 
            processor.getSemanticState().getFinalMuteState(channelName);
        
        // è·å–é€šé“ä¸ªäººå¢ç›Šï¼ˆæ¥è‡ªVST3å‚æ•°ï¼‰
        const String gainParamID = "GAIN_" + String(physicalIndex + 1);
        const float gainDb = processor.apvts.getRawParameterValue(gainParamID)->load();
        target->channelFinalGain[physicalIndex] = juce::Decibels::decibelsToGain(gainDb);
        
        // æ ‡è®°é€šé“æ¿€æ´»
        target->channelIsActive[physicalIndex] = true;
    }
}

void StateManager::collectMasterBusStates(RenderState* target)
{
    const auto& masterBus = processor.getMasterBusProcessor();
    
    // ç›´æ¥è·å–MasterBusProcessorè®¡ç®—çš„æœ€ç»ˆç»“æœ
    target->masterGainFactor = masterBus.getMasterGainPercent() * 0.01f;
    target->dimFactor = masterBus.isDimActive() ? 0.16f : 1.0f;
    target->masterMuteActive = masterBus.isMasterMuteActive();
    target->monoActive = masterBus.isMonoActive();
}
```

### 3. æç®€åŒ–çš„processBlockï¼ˆ<20è¡Œï¼‰

```cpp
//==============================================================================
void MonitorControllerMaxAudioProcessor::processBlock(juce::AudioBuffer<float>& buffer,
                                                     juce::MidiBuffer& midiMessages)
{
    juce::ScopedNoDenormals noDenormals;
    
    // å¿«é€Ÿè·¯å¾„æ£€æŸ¥
    const int numSamples = buffer.getNumSamples();
    if (numSamples == 0) return;
    
    // æ¸…é™¤æœªä½¿ç”¨çš„è¾“å‡ºé€šé“
    const int totalNumInputChannels = getTotalNumInputChannels();
    const int totalNumOutputChannels = getTotalNumOutputChannels();
    for (int i = totalNumInputChannels; i < totalNumOutputChannels; ++i) {
        buffer.clear(i, 0, numSamples);
    }
    
    // è·å–å½“å‰æ¸²æŸ“çŠ¶æ€ï¼ˆå•æ¬¡åŸå­è¯»å–ï¼Œé›¶é”ï¼‰
    const RenderState* renderState = stateManager->getCurrentRenderState();
    if (renderState == nullptr) return;
    
    // åº”ç”¨é¢„è®¡ç®—çš„çŠ¶æ€ï¼ˆé«˜åº¦ä¼˜åŒ–çš„å†…è”å‡½æ•°ï¼Œé›¶åˆ†é…ï¼‰
    renderState->applyToBuffer(buffer, numSamples);
    
    // å®Œæˆ - æ€»å…±çº¦18è¡Œä»£ç 
}
```

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬1é˜¶æ®µï¼šæ ¸å¿ƒç»„ä»¶å®ç°ï¼ˆ2å¤©ï¼‰

#### Day 1ï¼šåˆ›å»ºæ–°StateManagerå’ŒRenderState
**ç›®æ ‡**ï¼šå»ºç«‹ç¨³å®šçš„æ•°æ®å¿«ç…§ç³»ç»Ÿ

**ä»»åŠ¡**ï¼š
1. **åˆ é™¤é”™è¯¯çš„StateManagerå®ç°**
   - [ ] åˆ é™¤å½“å‰çš„StateManager.cpp/.hæ–‡ä»¶
   - [ ] æ¸…ç†PluginProcessorä¸­çš„StateManagerå¼•ç”¨

2. **å®ç°æ–°çš„RenderStateç»“æ„**
   - [ ] åˆ›å»ºRenderState.hï¼Œå®šä¹‰PODæ•°æ®ç»“æ„
   - [ ] å®ç°applyToBufferå’ŒapplyMonoEffecté«˜æ€§èƒ½æ–¹æ³•
   - [ ] ç¡®ä¿ç¼“å­˜å‹å¥½çš„å†…å­˜å¸ƒå±€

3. **å®ç°æ–°çš„StateManagerç±»**
   - [ ] åˆ›å»ºStateManager.h/.cppï¼Œå®ç°çŠ¶æ€æ”¶é›†å™¨
   - [ ] è¿æ¥åˆ°SemanticChannelStateç›‘å¬å™¨
   - [ ] è¿æ¥åˆ°AudioProcessorValueTreeStateç›‘å¬å™¨
   - [ ] å®ç°åŒç¼“å†²æœºåˆ¶

#### Day 2ï¼šé›†æˆæµ‹è¯•å’ŒprocessBlocké‡å†™
**ç›®æ ‡**ï¼šå®ŒæˆéŸ³é¢‘å¤„ç†é“¾è·¯ï¼Œæ¢å¤Solo/MuteåŠŸèƒ½

**ä»»åŠ¡**ï¼š
1. **é‡å†™processBlock**
   - [ ] å®ç°æç®€processBlockï¼ˆç›®æ ‡<20è¡Œï¼‰
   - [ ] ç¡®ä¿é›¶é”ã€é›¶åˆ†é…ã€é›¶å¤æ‚è®¡ç®—
   - [ ] æ·»åŠ åŸºç¡€çš„é”™è¯¯å¤„ç†

2. **åŸºç¡€åŠŸèƒ½æµ‹è¯•**
   - [ ] éªŒè¯Solo/MuteåŸºç¡€åŠŸèƒ½æ¢å¤æ­£å¸¸
   - [ ] éªŒè¯Masterå¢ç›Š/Dimæ•ˆæœæ­£å¸¸
   - [ ] éªŒè¯å¸ƒå±€åˆ‡æ¢ä¸å—å½±å“

3. **ç¨³å®šæ€§åˆæ­¥éªŒè¯**
   - [ ] è¿è¡ŒåŸºç¡€å‹åŠ›æµ‹è¯•
   - [ ] æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
   - [ ] éªŒè¯æ— ç¼–è¯‘è­¦å‘Š

### ç¬¬2é˜¶æ®µï¼šå®Œæ•´åŠŸèƒ½éªŒè¯ï¼ˆ2å¤©ï¼‰

#### Day 3ï¼šå¤æ‚åŠŸèƒ½éªŒè¯
**ç›®æ ‡**ï¼šç¡®ä¿æ‰€æœ‰ç°æœ‰åŠŸèƒ½100%æ­£å¸¸

**ä»»åŠ¡**ï¼š
1. **Solo/Muteå¤æ‚é€»è¾‘éªŒè¯**
   - [ ] éªŒè¯SUBé€šé“ç‰¹æ®Šé€»è¾‘å®Œå…¨æ­£ç¡®
   - [ ] éªŒè¯å…¨å±€Soloæ¨¡å¼å¤„ç†æ­£å¸¸
   - [ ] éªŒè¯çŠ¶æ€è®°å¿†å’Œæ¢å¤æœºåˆ¶

2. **Master-SlaveåŠŸèƒ½éªŒè¯**
   - [ ] éªŒè¯ä¸»ä»çŠ¶æ€åŒæ­¥æ­£å¸¸
   - [ ] éªŒè¯è§’è‰²åˆ‡æ¢åŠŸèƒ½
   - [ ] éªŒè¯å¤šå®ä¾‹å¹¶å‘è¿è¡Œ

3. **OSCå’Œå¤–éƒ¨æ§åˆ¶éªŒè¯**
   - [ ] éªŒè¯OSCåŒå‘æ§åˆ¶æ­£å¸¸
   - [ ] éªŒè¯å¤–éƒ¨è®¾å¤‡é›†æˆæ— é—®é¢˜
   - [ ] éªŒè¯çŠ¶æ€å¹¿æ’­æœºåˆ¶

#### Day 4ï¼šæ€§èƒ½ä¼˜åŒ–å’Œç¨³å®šæ€§æµ‹è¯•
**ç›®æ ‡**ï¼šè¾¾åˆ°å·¥ç¨‹çº§ç¨³å®šæ€§è¦æ±‚

**ä»»åŠ¡**ï¼š
1. **æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–**
   - [ ] æµ‹è¯•processBlockæ‰§è¡Œæ—¶é—´ï¼ˆç›®æ ‡<50Î¼sï¼‰
   - [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œç¡®ä¿é›¶åŠ¨æ€åˆ†é…
   - [ ] æµ‹è¯•CPUä½¿ç”¨ç‡æ”¹å–„æƒ…å†µ

2. **ç¨³å®šæ€§å‹åŠ›æµ‹è¯•**
   - [ ] é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ï¼ˆ6å°æ—¶ä»¥ä¸Šï¼‰
   - [ ] å¤šå®ä¾‹å¹¶å‘æµ‹è¯•
   - [ ] å¿«é€Ÿå‚æ•°å˜åŒ–æµ‹è¯•
   - [ ] å¸ƒå±€åˆ‡æ¢å‹åŠ›æµ‹è¯•

3. **çº¿ç¨‹å®‰å…¨éªŒè¯**
   - [ ] ä½¿ç”¨è°ƒè¯•å·¥å…·éªŒè¯æ— çº¿ç¨‹ç«äº‰
   - [ ] éªŒè¯æ— å†…å­˜æ³„æ¼
   - [ ] éªŒè¯æ— ç¼“å†²åŒºæº¢å‡º

### ç¬¬3é˜¶æ®µï¼šä»£ç æ¸…ç†å’Œæ–‡æ¡£ï¼ˆ1å¤©ï¼‰

#### Day 5ï¼šæœ€ç»ˆæ•´ç†
**ç›®æ ‡**ï¼šå®Œæˆé‡æ„ï¼Œå‡†å¤‡ç”Ÿäº§ä½¿ç”¨

**ä»»åŠ¡**ï¼š
1. **ä»£ç æ¸…ç†**
   - [ ] ç§»é™¤æ‰€æœ‰è°ƒè¯•ä»£ç å’Œä¸´æ—¶æ³¨é‡Š
   - [ ] ç»Ÿä¸€ä»£ç é£æ ¼å’Œå‘½å
   - [ ] æ·»åŠ å¿…è¦çš„æ–‡æ¡£æ³¨é‡Š

2. **æœ€ç»ˆéªŒè¯**
   - [ ] å®Œæ•´çš„åŠŸèƒ½å›å½’æµ‹è¯•
   - [ ] å‘å¸ƒç‰ˆæœ¬ç¼–è¯‘æµ‹è¯•
   - [ ] æ€§èƒ½åŸºå‡†éªŒè¯

3. **æ–‡æ¡£æ›´æ–°**
   - [ ] æ›´æ–°æ¶æ„æ–‡æ¡£
   - [ ] è®°å½•æ€§èƒ½æ”¹å–„æ•°æ®
   - [ ] åˆ›å»ºç»´æŠ¤æŒ‡å—

## ğŸ¯ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§ï¼ˆå¿…é¡»100%é€šè¿‡ï¼‰
- [ ] **Solo/Muteé€»è¾‘** - ä¸é‡æ„å‰è¡Œä¸ºå®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬æ‰€æœ‰SUBé€šé“ç‰¹æ®Šå¤„ç†
- [ ] **Master-SlaveåŒæ­¥** - é›¶å»¶è¿ŸçŠ¶æ€åŒæ­¥ï¼Œæ”¯æŒä»»æ„åŠ è½½é¡ºåº
- [ ] **æ€»çº¿æ•ˆæœ** - Master Gain/Dim/Mono/Low Boostç­‰æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- [ ] **OSCåŒå‘æ§åˆ¶** - å®Œæ•´çš„å¤–éƒ¨æ§åˆ¶å™¨é›†æˆ
- [ ] **å¸ƒå±€åŠ¨æ€åˆ‡æ¢** - æ— ç¼çš„æ‰¬å£°å™¨é…ç½®åˆ‡æ¢
- [ ] **å‚æ•°æŒä¹…åŒ–** - æ­£ç¡®çš„ä¿å­˜/åŠ è½½æœºåˆ¶

### æ€§èƒ½æŒ‡æ ‡ï¼ˆé‡åŒ–ç›®æ ‡ï¼‰
- [ ] **éŸ³é¢‘å»¶è¿Ÿ** - processBlockæ‰§è¡Œæ—¶é—´<50Î¼s @ 48kHzï¼ˆç›®æ ‡30Î¼sï¼‰
- [ ] **CPUä½¿ç”¨ç‡** - ç›¸æ¯”å½“å‰ç‰ˆæœ¬é™ä½80%ä»¥ä¸Š
- [ ] **å†…å­˜æ•ˆç‡** - éŸ³é¢‘çº¿ç¨‹é›¶åŠ¨æ€åˆ†é…
- [ ] **å“åº”é€Ÿåº¦** - UIæ“ä½œåˆ°éŸ³é¢‘å˜åŒ–å»¶è¿Ÿ<10ms

### ç¨³å®šæ€§æŒ‡æ ‡ï¼ˆé›¶å®¹å¿ï¼‰
- [ ] **é›¶å´©æºƒ** - 6å°æ—¶å‹åŠ›æµ‹è¯•æ— å´©æºƒ
- [ ] **çº¿ç¨‹å®‰å…¨** - æ— çº¿ç¨‹ç«äº‰ï¼Œæ— æ•°æ®ç«äº‰
- [ ] **å†…å­˜å®‰å…¨** - é›¶å†…å­˜æ³„æ¼ï¼Œé›¶ç¼“å†²åŒºæº¢å‡º
- [ ] **å¹¶å‘ç¨³å®š** - 10+æ’ä»¶å®ä¾‹å¹¶å‘è¿è¡Œæ— å†²çª

### ä»£ç è´¨é‡æŒ‡æ ‡
- [ ] **ç®€æ´æ€§** - processBlock<20è¡Œï¼ŒStateManageræ ¸å¿ƒæ–¹æ³•<50è¡Œ
- [ ] **å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„èŒè´£åˆ†å·¥ï¼Œç›´è§‚çš„å‘½å
- [ ] **ç¼–è¯‘è´¨é‡** - é›¶ç¼–è¯‘è­¦å‘Š

## ğŸš¨ é£é™©ç®¡ç†

### å…³é”®é£é™©ç‚¹

**é«˜é£é™©ï¼šSUBé€šé“é€»è¾‘è¿ç§»**
- **é£é™©**ï¼šSemanticChannelStateçš„å¤æ‚SUBé€»è¾‘å¯èƒ½åœ¨æ•°æ®æ”¶é›†è¿‡ç¨‹ä¸­å‡ºç°é—æ¼
- **ç¼“è§£**ï¼šç›´æ¥è°ƒç”¨getFinalMuteState()ï¼Œä¸é‡æ–°å®ç°ä»»ä½•é€»è¾‘
- **éªŒè¯**ï¼šå»ºç«‹å¯¹æ¯”æµ‹è¯•ï¼Œç¡®ä¿æ–°æ—§ç‰ˆæœ¬ç»“æœå®Œå…¨ä¸€è‡´

**ä¸­é£é™©ï¼šæ€§èƒ½ç›®æ ‡è¾¾æˆ**
- **é£é™©**ï¼šæ–°æ¶æ„å¯èƒ½æœªè¾¾åˆ°é¢„æœŸæ€§èƒ½æå‡
- **ç¼“è§£**ï¼šæ¸è¿›å¼ä¼˜åŒ–ï¼Œå…ˆç¡®ä¿åŠŸèƒ½æ­£ç¡®å†è¿½æ±‚æ€§èƒ½
- **åº”æ€¥**ï¼šå¦‚æ€§èƒ½ä¸è¾¾æ ‡ï¼Œä¼˜å…ˆä¿è¯ç¨³å®šæ€§

**ä½é£é™©ï¼šMaster-Slaveé€šä¿¡å½±å“**
- **é£é™©**ï¼šçŠ¶æ€æ”¶é›†æ–¹å¼æ”¹å˜å¯èƒ½å½±å“ä¸»ä»åŒæ­¥
- **ç¼“è§£**ï¼šä¿æŒGlobalPluginStateæ¥å£å®Œå…¨ä¸å˜
- **éªŒè¯**ï¼šå¤šå®ä¾‹æµ‹è¯•ç¡®ä¿åŒæ­¥æ­£å¸¸

## ğŸ¯ æ€»ç»“

æœ¬é‡æ„æ–¹æ¡ˆé‡‡ç”¨**æœ€å°æ”¹åŠ¨ï¼Œæœ€å¤§æ”¶ç›Š**çš„ç­–ç•¥ï¼š

### æ ¸å¿ƒä¼˜åŠ¿
1. **ä¿æŒç°æœ‰é€»è¾‘100%ä¸å˜** - æ‰€æœ‰å¤æ‚ä¸šåŠ¡é€»è¾‘ä¿æŒåœ¨åŸæœ‰ç»„ä»¶ä¸­
2. **æ¶æ„æç®€æ¸…æ™°** - åªæ·»åŠ 2ä¸ªç»„ä»¶ï¼Œåç§°ç›´è§‚ï¼ˆStateManager + RenderStateï¼‰
3. **å·¥ç¨‹çº§ç¨³å®šæ€§** - ä¸¥æ ¼éµå¾ªJUCEè§„èŒƒï¼Œé›¶é”é›¶åˆ†é…éŸ³é¢‘å¤„ç†
4. **ç»´æŠ¤æ€§æä½³** - èŒè´£æ¸…æ™°ï¼Œä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£å’Œæ‰©å±•

### æŠ€æœ¯åˆ›æ–°ç‚¹
- **çŠ¶æ€æ”¶é›†å™¨æ¨¡å¼** - StateManagerä½œä¸ºå„ç»„ä»¶çŠ¶æ€çš„æ”¶é›†å™¨ï¼Œä¸åšä¸šåŠ¡è®¡ç®—
- **é¢„è®¡ç®—+å¿«ç…§åº”ç”¨** - æ‰€æœ‰å¤æ‚è®¡ç®—åœ¨æ¶ˆæ¯çº¿ç¨‹å®Œæˆï¼ŒéŸ³é¢‘çº¿ç¨‹åªåšæ•°æ®åº”ç”¨
- **åŒç¼“å†²æ— é”è®¾è®¡** - æ¶ˆæ¯çº¿ç¨‹å’ŒéŸ³é¢‘çº¿ç¨‹å®Œå…¨è§£è€¦ï¼Œé›¶é˜»å¡

### é¢„æœŸæ•ˆæœ
- **ç¨³å®šæ€§å¤§å¹…æå‡** - å½»åº•æ¶ˆé™¤éŸ³é¢‘çº¿ç¨‹å´©æºƒé£é™©
- **æ€§èƒ½æ˜¾è‘—æ”¹å–„** - CPUä½¿ç”¨ç‡é™ä½80%ï¼ŒéŸ³é¢‘å»¶è¿Ÿé™ä½95%
- **ç”¨æˆ·ä½“éªŒä¸å˜** - æ‰€æœ‰åŠŸèƒ½è¡Œä¸ºå®Œå…¨ä¿æŒä¸€è‡´
- **ä»£ç è´¨é‡æå‡** - æ¶æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

è¿™æ˜¯ä¸€ä¸ªçœŸæ­£**å·¥ç¨‹çº§**çš„ç¨³å®šæ€§é‡æ„æ–¹æ¡ˆï¼Œé€šè¿‡ç®€æ´çš„è®¾è®¡å®ç°ç»å¯¹çš„ç¨³å®šæ€§ã€‚