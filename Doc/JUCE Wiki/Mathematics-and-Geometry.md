# Mathematics and Geometry

> **Relevant source files**
> * [modules/juce_audio_basics/sources/juce_ChannelRemappingAudioSource.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_audio_basics/sources/juce_ChannelRemappingAudioSource.cpp)
> * [modules/juce_core/containers/juce_ElementComparator.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/containers/juce_ElementComparator.h)
> * [modules/juce_core/containers/juce_SparseSet.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/containers/juce_SparseSet.cpp)
> * [modules/juce_core/containers/juce_SparseSet.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/containers/juce_SparseSet.h)
> * [modules/juce_core/maths/juce_BigInteger.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_BigInteger.cpp)
> * [modules/juce_core/maths/juce_BigInteger.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_BigInteger.h)
> * [modules/juce_core/maths/juce_Expression.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_Expression.h)
> * [modules/juce_core/maths/juce_MathsFunctions.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h)
> * [modules/juce_core/maths/juce_Random.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_Random.cpp)
> * [modules/juce_core/maths/juce_Random.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_Random.h)
> * [modules/juce_core/memory/juce_Atomic.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/memory/juce_Atomic.h)
> * [modules/juce_core/memory/juce_ByteOrder.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/memory/juce_ByteOrder.h)
> * [modules/juce_core/system/juce_CompilerSupport.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/system/juce_CompilerSupport.h)
> * [modules/juce_core/system/juce_PlatformDefs.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/system/juce_PlatformDefs.h)
> * [modules/juce_core/system/juce_TargetPlatform.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/system/juce_TargetPlatform.h)
> * [modules/juce_core/unit_tests/juce_UnitTest.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/unit_tests/juce_UnitTest.cpp)
> * [modules/juce_core/unit_tests/juce_UnitTest.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/unit_tests/juce_UnitTest.h)
> * [modules/juce_data_structures/app_properties/juce_PropertiesFile.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_data_structures/app_properties/juce_PropertiesFile.cpp)
> * [modules/juce_data_structures/app_properties/juce_PropertiesFile.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_data_structures/app_properties/juce_PropertiesFile.h)
> * [modules/juce_graphics/contexts/juce_LowLevelGraphicsContext.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/contexts/juce_LowLevelGraphicsContext.h)
> * [modules/juce_graphics/contexts/juce_LowLevelGraphicsSoftwareRenderer.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/contexts/juce_LowLevelGraphicsSoftwareRenderer.cpp)
> * [modules/juce_graphics/contexts/juce_LowLevelGraphicsSoftwareRenderer.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/contexts/juce_LowLevelGraphicsSoftwareRenderer.h)
> * [modules/juce_graphics/geometry/juce_AffineTransform.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_AffineTransform.cpp)
> * [modules/juce_graphics/geometry/juce_AffineTransform.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_AffineTransform.h)
> * [modules/juce_graphics/geometry/juce_EdgeTable.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_EdgeTable.cpp)
> * [modules/juce_graphics/geometry/juce_EdgeTable.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_EdgeTable.h)
> * [modules/juce_graphics/geometry/juce_Line.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Line.h)
> * [modules/juce_graphics/geometry/juce_Point.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Point.h)
> * [modules/juce_graphics/geometry/juce_Rectangle.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Rectangle.h)
> * [modules/juce_graphics/geometry/juce_RectangleList.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_RectangleList.h)
> * [modules/juce_graphics/native/juce_RenderingHelpers.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/native/juce_RenderingHelpers.h)
> * [modules/juce_gui_basics/positioning/juce_RelativeCoordinate.cpp](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_gui_basics/positioning/juce_RelativeCoordinate.cpp)
> * [modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h)

This page documents the core mathematical functions, numeric types, and 2D geometry primitives in the JUCE framework. These systems are foundational for graphics, GUI layout, audio processing, and data manipulation throughout JUCE.

Mathematics and geometry in JUCE are implemented primarily in the `juce_core` and `juce_graphics` modules. The code entities described here are used by higher-level systems such as the graphics renderer, component layout, and audio buffer manipulation.

## 1. Mathematical Constants and Core Functions

JUCE provides mathematical constants, type-safe numeric types, and a set of utility functions for common mathematical operations. These are defined in `juce_MathsFunctions.h`.

### 1.1 Mathematical Constants

The `MathConstants` template struct provides type-safe mathematical constants for `float`, `double`, and other numeric types.

| Constant | Description | Example Value (double) |
| --- | --- | --- |
| `pi` | Pi | 3.141592653589793... |
| `twoPi` | 2 × Pi | 6.283185307179586... |
| `halfPi` | Pi / 2 | 1.570796326794896... |
| `euler` | Euler's e | 2.718281828459045... |
| `sqrt2` | √2 | 1.414213562373095... |

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L145-L166](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L145-L166)

### 1.2 Angle Conversion

Functions for converting between degrees and radians:

* `degreesToRadians(degrees)`
* `radiansToDegrees(radians)`

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L178-L184](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L178-L184)

### 1.3 Floating-Point Comparison and Tolerance

JUCE provides robust floating-point comparison utilities:

* `exactlyEqual(a, b)`: Direct comparison, suppresses float-equality warnings.
* `approximatelyEqual(a, b, tolerance)`: Compares with absolute and/or relative tolerance.
* `juce_isfinite(value)`: Cross-platform check for finite values.

#### Diagram: Comparison Functions and Tolerance

```

```

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L207-L330](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L207-L330)

### 1.4 Min/Max, Mapping, and Value Constraints

* `jmax(a, b, ...)`, `jmin(a, b, ...)`: Return the maximum/minimum of values.
* `jlimit(lower, upper, value)`: Clamp a value to a range.
* `jmap(value, ...)`: Remap a value from one range to another.
* `mapToLog10`, `mapFromLog10`: Map values to/from logarithmic ranges.

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L346-L433](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L346-L433)

 [modules/juce_core/maths/juce_MathsFunctions.h L500-L529](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L500-L529)

### 1.5 Rounding and Conversion

* `roundToInt(value)`: Fast float-to-int conversion (rounds).
* `roundToIntAccurate(value)`: More accurate, slightly slower.
* `truncatePositiveToUnsignedInt(value)`: Truncates positive float to unsigned int.

#### Diagram: Rounding and Conversion Functions

```

```

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L585-L654](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L585-L654)

## 2. Numeric Types and Bitwise Utilities

JUCE defines platform-independent numeric types and bit manipulation utilities for cross-platform consistency.

### 2.1 Integer Types

| Type | Description |
| --- | --- |
| `int8`, `uint8` | 8-bit signed/unsigned integer |
| `int16`, `uint16` | 16-bit signed/unsigned integer |
| `int32`, `uint32` | 32-bit signed/unsigned integer |
| `int64`, `uint64` | 64-bit signed/unsigned integer |
| `pointer_sized_int` | Signed integer large enough for a pointer |
| `pointer_sized_uint` | Unsigned integer large enough for a pointer |

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L44-L99](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L44-L99)

### 2.2 Bit Manipulation Functions

* `isPowerOfTwo(value)`: Checks if a value is a power of two.
* `nextPowerOfTwo(n)`: Returns the next power of two ≥ n.
* `findHighestSetBit(n)`: Returns the index of the highest set bit.
* `countNumberOfBits(n)`: Counts the number of set bits in a value.
* `readLittleEndianBitsInBuffer`, `writeLittleEndianBitsInBuffer`: Read/write bitfields in memory buffers.

#### Diagram: Bit Manipulation Functions

```

```

Sources: [modules/juce_core/maths/juce_MathsFunctions.h L657-L734](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_MathsFunctions.h#L657-L734)

 [modules/juce_core/maths/juce_BigInteger.cpp L38-L63](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_BigInteger.cpp#L38-L63)

### 2.3 Endianness Handling

The `ByteOrder` class provides static methods for byte swapping and endianness conversion:

* `swap(uint16/int16/uint32/etc.)`
* `swapIfBigEndian()`, `swapIfLittleEndian()`
* `littleEndianInt()`, `bigEndianInt()`
* `makeInt()` (constructs integer from bytes)

#### Diagram: ByteOrder Class Functions

```

```

Sources: [modules/juce_core/memory/juce_ByteOrder.h L39-L147](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/memory/juce_ByteOrder.h#L39-L147)

## 3. 2D Geometry Primitives

JUCE provides a set of template-based classes for 2D geometry, supporting both integer and floating-point types.

### 3.1 Point

`Point<ValueType>` represents a 2D coordinate.

* Construction: `Point(x, y)`
* Arithmetic: `+`, `-`, `*`, `/`
* Geometric: `getDistanceFrom`, `getAngleToPoint`, `rotatedAboutOrigin`, `getDotProduct`
* Transformation: `applyTransform`, `transformedBy`
* Type conversion: `toInt`, `toFloat`, `toDouble`

#### Diagram: Point Class Methods

```

```

Sources: [modules/juce_graphics/geometry/juce_Point.h L39-L269](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Point.h#L39-L269)

### 3.2 Line

`Line<ValueType>` represents a line segment.

* Construction: `Line(start, end)`, `Line(x1, y1, x2, y2)`
* Properties: `getStart`, `getEnd`, `getLength`, `getAngle`
* Operations: `getIntersection`, `intersects`, `getPointAlongLine`, `isVertical`, `isHorizontal`

#### Diagram: Line Class Methods

```

```

Sources: [modules/juce_graphics/geometry/juce_Line.h L39-L396](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Line.h#L39-L396)

### 3.3 Rectangle

`Rectangle<ValueType>` represents a rectangle.

* Construction: `Rectangle(x, y, width, height)`, `Rectangle(Point, Point)`, `leftTopRightBottom()`
* Properties: `getX`, `getY`, `getWidth`, `getHeight`, `getRight`, `getBottom`, `getCentre`
* Modification: `withX`, `withY`, `withWidth`, `withHeight`, `withSizeKeepingCentre`, `expanded`, `reduced`
* Queries: `contains`, `intersects`, `isEmpty`, `isFinite`
* Transformation: `translated`, `operator+`, `operator-`, `operator*`, `operator/`, `transformedBy`

#### Diagram: Rectangle Class Methods

```

```

Sources: [modules/juce_graphics/geometry/juce_Rectangle.h L67-L822](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_Rectangle.h#L67-L822)

### 3.4 RectangleList

`RectangleList<ValueType>` manages a set of rectangles as a region.

* Add/remove rectangles: `add`, `subtract`
* Query: `isEmpty`, `getNumRectangles`, `getRectangle`
* Operations: `clipTo`, `intersectWith`, `contains`, `getBounds`

#### Diagram: RectangleList Class Methods

```

```

Sources: [modules/juce_graphics/geometry/juce_RectangleList.h L39-L602](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_RectangleList.h#L39-L602)

## 4. 2D Transformations

The `AffineTransform` class represents 2D affine transformations, including translation, rotation, scaling, and shearing.

### 4.1 AffineTransform Class

* Matrix representation: 3×3, but only 6 values are stored (`mat00`, `mat01`, `mat02`, `mat10`, `mat11`, `mat12`)
* Factory methods: `translation(x, y)`, `rotation(angle)`, `rotation(angle, pivotX, pivotY)`, `scale(sx, sy)`, `shear(sx, sy)`
* Operations: `followedBy`, `inverted`, `getDeterminant`, `transformPoint`, `transformPoints`

#### Diagram: AffineTransform Methods and Matrix

```

```

The matrix is:

```
| mat00 mat01 mat02 |
| mat10 mat11 mat12 |
|   0     0     1   |
```

Sources: [modules/juce_graphics/geometry/juce_AffineTransform.h L39-L399](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_AffineTransform.h#L39-L399)

 [modules/juce_graphics/geometry/juce_AffineTransform.cpp L35-L254](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_AffineTransform.cpp#L35-L254)

### 4.2 Chaining and Combining Transformations

Transformations can be chained using `followedBy` or by calling methods in sequence:

* `AffineTransform::scale(...).rotated(...).translated(...)`

| Transformation | Description | Factory Method |
| --- | --- | --- |
| Translation | Move by (x, y) | `translation(x, y)` |
| Rotation | Rotate around origin | `rotation(angle)` |
| Rotation (pivot) | Rotate around point (px, py) | `rotation(angle, px, py)` |
| Scaling | Scale from origin | `scale(sx, sy)` |
| Scaling (pivot) | Scale from point (px, py) | `scale(sx, sy, px, py)` |
| Shearing | Shear in x/y | `shear(sx, sy)` |

Sources: [modules/juce_graphics/geometry/juce_AffineTransform.cpp L97-L189](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/geometry/juce_AffineTransform.cpp#L97-L189)

## 5. Advanced Mathematics

### 5.1 BigInteger

`BigInteger` provides arbitrary-precision integer arithmetic and bit manipulation.

* Construction: from integer, string, or another `BigInteger`
* Arithmetic: `+`, `-`, `*`, `/`, `modulo`
* Bit operations: `setBit`, `clearBit`, `operator[]`, `countNumberOfSetBits`
* Conversion: to/from string, integer, binary

#### Diagram: BigInteger Class and Methods

```

```

Sources: [modules/juce_core/maths/juce_BigInteger.h L39-L815](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_BigInteger.h#L39-L815)

 [modules/juce_core/maths/juce_BigInteger.cpp L65-L812](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_BigInteger.cpp#L65-L812)

### 5.2 Random Number Generation

`Random` provides pseudo-random number generation.

* Construction: `Random(seed)`, `Random::getSystemRandom()`
* Methods: `nextInt()`, `nextInt(max)`, `nextFloat()`, `nextBool()`, `nextInt64()`
* Seeding: `setSeed`, `setSeedRandomly`, `combineSeed`

#### Diagram: Random Class and Methods

```

```

Sources: [modules/juce_core/maths/juce_Random.h L39-L194](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_Random.h#L39-L194)

 [modules/juce_core/maths/juce_Random.cpp L38-L190](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_core/maths/juce_Random.cpp#L38-L190)

## 6. Integration with Other JUCE Systems

Mathematics and geometry classes are used throughout JUCE, especially in graphics, GUI, and audio systems.

#### Diagram: Integration of Mathematics and Geometry with Other Systems

```

```

* **Graphics System**: Geometry classes are used for path rendering, image transformations, and text layout ([modules/juce_graphics/native/juce_RenderingHelpers.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/native/juce_RenderingHelpers.h) ).
* **Component Positioning**: Used in component bounds, the `RelativeCoordinate` system, and animation ([modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h) ).
* **Audio Processing**: Used for buffer calculations and DSP operations.
* **File Operations**: Used for binary data handling and file position calculations.

Sources: [modules/juce_graphics/native/juce_RenderingHelpers.h](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_graphics/native/juce_RenderingHelpers.h)

 [modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h L38-L102](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_gui_basics/positioning/juce_RelativeCoordinate.h#L38-L102)

 [modules/juce_gui_basics/positioning/juce_RelativeCoordinate.cpp L38-L57](https://github.com/juce-framework/JUCE/blob/d6181bde/modules/juce_gui_basics/positioning/juce_RelativeCoordinate.cpp#L38-L57)

## 7. Best Practices

### 7.1 Floating-Point Comparisons

Always use `approximatelyEqual()` instead of `==` for comparing floating-point values:

```
// Incorrect - may fail due to floating-point precision
if (floatValue == 0.1f + 0.2f) { ... }

// Correct - accounts for floating-point errors
if (approximatelyEqual(floatValue, 0.1f + 0.2f)) { ... }

// With custom tolerance for specific needs
if (approximatelyEqual(floatValue, targetValue, 
                      absoluteTolerance(0.0001f))) { ... }
```

### 7.2 Rectangle Manipulation

When manipulating rectangles, prefer the chainable methods for clarity:

```
// Less readable with multiple steps
Rectangle<int> rect(10, 10, 100, 100);
rect.setX(rect.getX() + 5);
rect.setWidth(rect.getWidth() - 10);

// More readable with chainable methods
Rectangle<int> rect(10, 10, 100, 100);
rect = rect.withX(15).withWidth(90);
```

### 7.3 Coordinate System Awareness

Remember that JUCE's coordinate system has (0,0) at the top-left corner, with positive y moving downward. This follows the convention commonly used in computer graphics but differs from mathematical convention.

```
(0,0) --> +x
  |
  v
  +y
```

This impacts how you interpret angles (which still use the standard mathematical convention with 0 at "east" and increasing counterclockwise) and transformations.