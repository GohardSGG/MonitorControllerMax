# v4.1 Master Bus Processorç³»ç»Ÿ - å®Œæˆæ€»ç»“

## âœ… **å®æ–½å®ŒæˆçŠ¶æ€ (2025-07-14)**

**MonitorControllerMax v4.1 Master Bus Processorç³»ç»Ÿå·²å®Œæ•´å®ç°å¹¶éªŒæ”¶é€šè¿‡ï¼**

åŸºäºv4.0ç¨³å®šçš„Master-Slaveæ¶æ„ï¼Œv4.1æˆåŠŸå®ç°äº†ä¸“ä¸šçº§æ€»çº¿æ•ˆæœå¤„ç†ç³»ç»Ÿã€‚

**OSCéªŒè¯çŠ¶æ€ï¼š** ç³»ç»Ÿåœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹å·²éªŒè¯ /Monitor/Master/Dim åœ°å€æ§åˆ¶å·¥ä½œæ­£å¸¸ï¼Œå®ç°äº†å®Œæ•´çš„OSCåŒå‘é€šä¿¡ã€‚

## ğŸµ **v4.1æ–°å¢åŠŸèƒ½å®ŒæˆçŠ¶æ€**

### âœ… Phase 1: MasterBusProcessoræ ¸å¿ƒç±» - å®Œæˆ
- âœ… **ç‹¬ç«‹æ€»çº¿å¤„ç†å™¨** - ä¸“ç”¨MasterBusProcessorç±»ï¼ŒèŒè´£å•ä¸€
- âœ… **JSFXç®—æ³•å…¼å®¹** - åŸºäºMonitor Controllor 7.1.4.jsfxçš„ç²¾ç¡®æ•°å­¦å®ç°
- âœ… **Master Gainæ§åˆ¶** - 0-100%çº¿æ€§è¡°å‡å™¨ï¼ŒVST3å‚æ•°ï¼ŒæŒä¹…åŒ–ä¿å­˜
- âœ… **DimåŠŸèƒ½å®ç°** - å†…éƒ¨çŠ¶æ€è¡°å‡åˆ°16%ï¼Œä¼šè¯çº§åˆ«ä¿å­˜ï¼Œä¸æŒä¹…åŒ–
- âœ… **è§’è‰²æ—¥å¿—æ”¯æŒ** - å®Œæ•´çš„è§’è‰²æ„ŸçŸ¥è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ

### âœ… Phase 2: è§’è‰²åŒ–Gainå¤„ç†æ¶æ„ - å®Œæˆ
- âœ… **Slaveå¤„ç†é™åˆ¶** - Slaveæ’ä»¶åªå¤„ç†Solo/MuteçŠ¶æ€ï¼Œä¸å¤„ç†ä»»ä½•Gain
- âœ… **Masterå®Œæ•´å¤„ç†** - Master/Standaloneå¤„ç†ä¸ªäººé€šé“Gain + æ€»çº¿æ•ˆæœ
- âœ… **processBlockä¼˜åŒ–** - æ˜ç¡®çš„è§’è‰²åˆ†å·¥ï¼Œé¿å…é‡å¤å¤„ç†
- âœ… **éŸ³é¢‘é“¾å®Œæ•´æ€§** - Slave(æ ¡å‡†å‰) â†’ å¤–éƒ¨æ ¡å‡† â†’ Master(æ ¡å‡†å)

### âœ… Phase 3: OSCåè®®æ‰©å±• - å®Œæˆ (å·²éªŒè¯)
- âœ… **æ–°OSCåœ°å€æ”¯æŒ** - /Monitor/Master/Volume å’Œ /Monitor/Master/Dim
- âœ… **åŒå‘OSCé€šä¿¡** - å‘é€å’Œæ¥æ”¶Masteræ€»çº¿æ§åˆ¶æ¶ˆæ¯
- âœ… **è§’è‰²åŒ–OSCå‘é€** - åªæœ‰Master/Standaloneå‘é€OSCï¼Œé¿å…æ¶ˆæ¯é‡å¤
- âœ… **å‚æ•°åŒæ­¥æ•´åˆ** - OSCæ§åˆ¶è‡ªåŠ¨åŒæ­¥åˆ°VST3å‚æ•°ç³»ç»Ÿ
- âœ… **å®æ—¶éªŒè¯é€šè¿‡** - OSC Dimæ§åˆ¶åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹æµ‹è¯•æˆåŠŸ

### âœ… Phase 4: UIé›†æˆå®Œå–„ - å®Œæˆ
- âœ… **DimæŒ‰é’®è¿æ¥** - UI DimæŒ‰é’®ç›´æ¥æ§åˆ¶MasterBusProcessorçŠ¶æ€
- âœ… **è§’è‰²æƒé™æ£€æŸ¥** - Slaveæ¨¡å¼ç¦æ­¢æ“ä½œMasteræ€»çº¿æ§ä»¶
- âœ… **çŠ¶æ€å®æ—¶æ›´æ–°** - DimçŠ¶æ€æ”¹å˜ç«‹å³å‘é€OSCå¹¶æ›´æ–°UI
- âœ… **å‚æ•°è”åŠ¨å®Œæ•´** - Master Gain VST3å‚æ•°å˜åŒ–è‡ªåŠ¨è§¦å‘OSCå‘é€

## ğŸ“‹ **v4.0åŸºç¡€åŠŸèƒ½ (å·²å®Œæˆ)**

### âœ… Phase 1: GlobalPluginStateæ ¸å¿ƒç±» - å®Œæˆ
- âœ… **çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼** - æ”¯æŒå¤šçº¿ç¨‹DAWç¯å¢ƒ
- âœ… **æ’ä»¶å®ä¾‹ç®¡ç†** - è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€æœºåˆ¶
- âœ… **Master/Slaveè§’è‰²ç®¡ç†** - æ™ºèƒ½è§’è‰²åˆ‡æ¢
- âœ… **é›¶å»¶è¿ŸçŠ¶æ€åŒæ­¥** - ç›´æ¥å†…å­˜è®¿é—®å¹¿æ’­æœºåˆ¶
- âœ… **ç­‰å¾…é˜Ÿåˆ—æ”¯æŒ** - æ”¯æŒä»»æ„æ’ä»¶åŠ è½½é¡ºåº

### âœ… Phase 2: è§’è‰²ç®¡ç†ç³»ç»Ÿé›†æˆ - å®Œæˆ
- âœ… **ä¸‰ç§è§’è‰²å®šä¹‰** - Standalone/Master/Slave
- âœ… **æ™ºèƒ½è§’è‰²åˆ‡æ¢** - `switchToStandalone()`, `switchToMaster()`, `switchToSlave()`
- âœ… **çŠ¶æ€åŒæ­¥å›è°ƒ** - MasterçŠ¶æ€å¹¿æ’­åˆ°æ‰€æœ‰Slaves
- âœ… **å¾ªç¯é˜²æŠ¤æœºåˆ¶** - `suppressStateChange`æ ‡å¿—é¿å…çŠ¶æ€å¾ªç¯
- âœ… **è¿æ¥çŠ¶æ€æŸ¥è¯¢** - å®Œæ•´çš„è¿æ¥çŠ¶æ€API

### âœ… Phase 3: UIé›†æˆé€‚é… - å®Œæˆ
- âœ… **è§’è‰²é€‰æ‹©å™¨** - ä¸‹æ‹‰æ¡†æ‰‹åŠ¨é€‰æ‹©æ’ä»¶è§’è‰²
- âœ… **è¿æ¥çŠ¶æ€æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤ºMaster-Slaveè¿æ¥ä¿¡æ¯
- âœ… **Slave UIé”å®š** - ç°è‰²é®ç½©ï¼Œå®Œå…¨åªè¯»æ˜¾ç¤º
- âœ… **UIçŠ¶æ€æŒä¹…åŒ–** - çª—å£å…³é—­/é‡å¼€çŠ¶æ€ç»´æŒä¸å˜
- âœ… **å®æ—¶çŠ¶æ€æ›´æ–°** - Masteræ“ä½œç«‹å³åæ˜ åˆ°Slave UI

### âœ… Phase 4: æ™ºèƒ½çŠ¶æ€ç®¡ç† - å®Œæˆ
- âœ… **å¹²å‡€å¯åŠ¨ç­–ç•¥** - ç§»é™¤Solo/MuteçŠ¶æ€çš„æ„å¤–æŒä¹…åŒ–
- âœ… **é€‰æ‹©æ€§æŒä¹…åŒ–** - ä¿ç•™Gainå‚æ•°ã€è§’è‰²ã€å¸ƒå±€é…ç½®
- âœ… **ä¼šè¯çŠ¶æ€ç»´æŒ** - DAWä¼šè¯æœŸé—´çŠ¶æ€é€šè¿‡å†…å­˜å¯¹è±¡ç»´æŒ
- âœ… **è§’è‰²åŒ–OSCé€šä¿¡** - åªæœ‰Masterå’ŒStandaloneå‘é€OSCæ¶ˆæ¯

## ğŸ¯ **æ¶æ„å®ç°ç‰¹è‰²**

### ğŸš€ æŠ€æœ¯çªç ´
```cpp
// é›¶å»¶è¿ŸåŒæ­¥ - ç›´æ¥å†…å­˜è®¿é—®
void GlobalPluginState::broadcastStateToSlaves(channelName, action, state) {
    for (auto* slave : slavePlugins) {
        slave->receiveGlobalState(channelName, action, state);  // çº³ç§’çº§å»¶è¿Ÿ
    }
}

// è§’è‰²åŒ–å¤„ç† - ä¸“ä¸šéŸ³é¢‘å¤„ç†é“¾åˆ†å·¥
Slaveæ’ä»¶(æ ¡å‡†å‰) â†’ å¤–éƒ¨æ ¡å‡†è½¯ä»¶ â†’ Masteræ’ä»¶(æ ¡å‡†å)
```

### ğŸ’¡ æ™ºèƒ½çŠ¶æ€ç®¡ç†
```cpp
// v4.0æ–°çš„æŒä¹…åŒ–ç­–ç•¥
getStateInformation() {
    // âœ… ä¿å­˜: Gainå‚æ•°ã€è§’è‰²é€‰æ‹©ã€å¸ƒå±€é…ç½®
    // âŒ ä¸ä¿å­˜: Solo/MuteçŠ¶æ€ (é¿å…æ„å¤–æŒä¹…åŒ–)
}

setStateInformation() {
    // âœ… æ¢å¤: é‡è¦çš„ç”¨æˆ·é…ç½®
    // âŒ ä¸æ¢å¤: Solo/MuteçŠ¶æ€ (ç¡®ä¿å¹²å‡€å¯åŠ¨)
}
```

### ğŸ”§ è§’è‰²æ„ŸçŸ¥ç³»ç»Ÿ
```cpp
// å®Œæ•´çš„è§’è‰²æ„ŸçŸ¥æ—¥å¿—å’Œå¤„ç†
#define VST3_DBG_ROLE(processorPtr, message)
// è¾“å‡º: [Master], [Slave], [Standalone] å‰ç¼€æ—¥å¿—

// è§’è‰²åˆ†å·¥è¡¨
| è§’è‰² | OSCå‘é€ | OSCæ¥æ”¶ | éŸ³é¢‘å¤„ç† | ç•Œé¢æ§åˆ¶ | ä¸»ä»åŒæ­¥ |
|------|---------|---------|----------|----------|----------|
| Standalone | âœ… | âœ… | âœ… | âœ… | âŒ |
| Master | âœ… | âœ… | âœ… | âœ… | âœ…å‘é€ |
| Slave | âŒ | âŒ | âœ… | âœ…æ˜¾ç¤º | âœ…æ¥æ”¶ |
```

## ğŸ† **éªŒæ”¶æ ‡å‡† - å…¨éƒ¨é€šè¿‡**

### âœ… æ ¸å¿ƒåŠŸèƒ½éªŒæ”¶
- âœ… **è§’è‰²åˆ‡æ¢** - ä¸‰ç§è§’è‰²æ— ç¼åˆ‡æ¢ï¼ŒMasterå†²çªæ­£ç¡®å¤„ç†
- âœ… **çŠ¶æ€åŒæ­¥** - Masteræ“ä½œå®æ—¶åŒæ­¥åˆ°æ‰€æœ‰Slaves (< 1mså»¶è¿Ÿ)
- âœ… **UIå“åº”** - Slave UIæ­£ç¡®é”å®šï¼Œè¿æ¥çŠ¶æ€å‡†ç¡®æ˜¾ç¤º
- âœ… **ç”Ÿå‘½å‘¨æœŸ** - æ’ä»¶åŠ è½½/å¸è½½æ­£ç¡®å¤„ç†ï¼Œæ— å†…å­˜æ³„æ¼

### âœ… é›†æˆå…¼å®¹æ€§éªŒæ”¶
- âœ… **ç°æœ‰åŠŸèƒ½ä¿æŒ** - Solo/Muteé€»è¾‘ã€OSCé€šä¿¡ã€é…ç½®ç³»ç»Ÿå®Œå…¨ä¸å˜
- âœ… **æ€§èƒ½å½±å“** - CPU/å†…å­˜å ç”¨å¢é‡ < 2%
- âœ… **ç¼–è¯‘ç¨³å®šæ€§** - Debug/Releaseç¼–è¯‘æˆåŠŸï¼Œæ— è­¦å‘Šé”™è¯¯

### âœ… æ™ºèƒ½çŠ¶æ€ç®¡ç†éªŒæ”¶
- âœ… **å¹²å‡€å¯åŠ¨** - æ’ä»¶é‡æ–°åŠ è½½æ—¶Solo/MuteçŠ¶æ€ä¸ºåˆå§‹å¹²å‡€çŠ¶æ€
- âœ… **ä¼šè¯æŒä¹…åŒ–** - DAWä¼šè¯æœŸé—´çŠ¶æ€æ­£ç¡®ç»´æŒ
- âœ… **UIçŠ¶æ€åŒæ­¥** - çª—å£å…³é—­/é‡å¼€ä¸å½±å“çŠ¶æ€ä¸€è‡´æ€§

## ğŸµ **ä¸“ä¸šåº”ç”¨åœºæ™¯**

### å…¸å‹å·¥ä½œæµ
```
å½•éŸ³å®¤ç›‘å¬é“¾è·¯:
DAW â†’ Slaveæ’ä»¶(é¢„è¿‡æ»¤) â†’ æˆ¿é—´æ ¡æ­£ â†’ Masteræ’ä»¶(æœ€ç»ˆæ§åˆ¶) â†’ ç›‘å¬éŸ³ç®±

ç°åœºç›‘å¬ç³»ç»Ÿ:
è°ƒéŸ³å° â†’ Slaveæ’ä»¶ç»„(é€šé“è¿‡æ»¤) â†’ DSPå¤„ç†å™¨ â†’ Masteræ’ä»¶(æ€»æ§) â†’ å¤šè·¯ç›‘å¬

åæœŸåˆ¶ä½œå·¥ä½œæµ:
æ—¶é—´çº¿ â†’ Slaveæ’ä»¶(é¢„å¤„ç†) â†’ å¤–éƒ¨å¤„ç†å™¨ â†’ Masteræ’ä»¶(ç›‘å¬æ§åˆ¶) â†’ å‚è€ƒç›‘å¬
```

## ğŸ“ **å·²å®ç°çš„æ–‡ä»¶æ¸…å•**

### æ–°å¢æ ¸å¿ƒæ–‡ä»¶
- âœ… `Source/GlobalPluginState.h/cpp` - ä¸»ä»é€šä¿¡æ ¸å¿ƒç±»
- âœ… `Source/DebugLogger.h` - VST3è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ

### é‡è¦æ‰©å±•æ–‡ä»¶
- âœ… `Source/PluginProcessor.h/cpp` - è§’è‰²ç®¡ç†å’ŒçŠ¶æ€åŒæ­¥
- âœ… `Source/PluginEditor.h/cpp` - UIè§’è‰²é€‚é…å’Œé”å®š
- âœ… `Source/SemanticChannelState.h/cpp` - Master-SlaveçŠ¶æ€å¹¿æ’­
- âœ… `Source/OSCCommunicator.h/cpp` - è§’è‰²åŒ–OSCé€šä¿¡
- âœ… `Source/PhysicalChannelMapper.h/cpp` - è§’è‰²æ„ŸçŸ¥æ˜ å°„

### é…ç½®å’Œæ–‡æ¡£
- âœ… `Doc/Dev.md` - v4.0å®Œæ•´å¼€å‘æ–‡æ¡£
- âœ… `CLAUDE.md` - æ›´æ–°ä¸ºv4.0æ¶æ„å’ŒUTF-8 BOMæ ‡å‡†
- âœ… `Debug/claude_auto_build.sh` - ä¸€é”®å¼€å‘å·¥å…·å¥—ä»¶

## ğŸš€ **v4.0é¡¹ç›®æ€»ç»“**

**æŠ€æœ¯æˆå°±ï¼š**
- ğŸ”¥ **å®Œæ•´çš„Master-Slaveæ¶æ„** - é›¶å»¶è¿Ÿã€çº¿ç¨‹å®‰å…¨çš„æ’ä»¶é€šä¿¡ç³»ç»Ÿ
- ğŸ¯ **è§’è‰²åŒ–å¤„ç†** - ä¸“ä¸šéŸ³é¢‘å¤„ç†é“¾çš„æ™ºèƒ½åˆ†å·¥
- ğŸ’¡ **æ™ºèƒ½çŠ¶æ€ç®¡ç†** - å¹²å‡€å¯åŠ¨ç­–ç•¥ï¼Œå®Œç¾çš„æŒä¹…åŒ–æ§åˆ¶
- âš¡ **åŒè¿›ç¨‹ä¼˜åŒ–** - ä¸“ä¸ºDAWè®¾è®¡çš„é«˜æ•ˆé€šä¿¡æœºåˆ¶

**ç”¨æˆ·ä»·å€¼ï¼š**
- ğŸ›ï¸ **ä¸“ä¸šå·¥ä½œæµæ”¯æŒ** - æ ¡å‡†å‰/ååˆ†ç¦»çš„ä¸“ä¸šéŸ³é¢‘å¤„ç†é“¾
- ğŸ”„ **çµæ´»éƒ¨ç½²** - æ”¯æŒä»»æ„æ’ä»¶åŠ è½½é¡ºåºå’Œè§’è‰²åˆ‡æ¢
- ğŸ–¥ï¸ **ç›´è§‚æ“ä½œ** - Masterå®Œå…¨æ§åˆ¶ï¼ŒSlaveåªè¯»æ˜¾ç¤º
- ğŸ” **è°ƒè¯•å‹å¥½** - å®Œæ•´çš„è§’è‰²æ„ŸçŸ¥æ—¥å¿—å’ŒçŠ¶æ€è¯Šæ–­

**MonitorControllerMax v4.0æ ‡å¿—ç€ä¸“ä¸šç›‘å¬æ§åˆ¶æ’ä»¶çš„é‡å¤§çªç ´ï¼**

**é¡¹ç›®çŠ¶æ€ï¼šâœ… v4.1å®Œæ•´å®ç°ï¼Œå…¨éƒ¨éªŒæ”¶é€šè¿‡ï¼Œå·²æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ï¼** ğŸµğŸš€

## ğŸ¯ **v4.1å®ç°è¯¦ç»†è®°å½•**

### æ–°å¢æ–‡ä»¶
- âœ… `Source/MasterBusProcessor.h` - æ€»çº¿æ•ˆæœå¤„ç†å™¨å¤´æ–‡ä»¶
- âœ… `Source/MasterBusProcessor.cpp` - æ€»çº¿æ•ˆæœå¤„ç†å™¨å®ç°

### ä¿®æ”¹æ–‡ä»¶
- âœ… `Source/PluginProcessor.h` - æ·»åŠ MasterBusProcessoré›†æˆå’ŒMASTER_GAINå‚æ•°
- âœ… `Source/PluginProcessor.cpp` - å®ç°è§’è‰²åŒ–Gainå¤„ç†åˆ†å·¥å’Œæ€»çº¿æ•ˆæœå¤„ç†
- âœ… `Source/PluginEditor.cpp` - è¿æ¥DimæŒ‰é’®åˆ°MasterBusProcessor

### æ ¸å¿ƒç®—æ³•å®ç°
```cpp
// åŸºäºJSFX Monitor Controllor 7.1.4çš„ç²¾ç¡®æ•°å­¦å®ç°
float MasterBusProcessor::calculateMasterLevel() const {
    float baseLevel = masterGainPercent * SCALE_FACTOR;  // 0-100% -> 0.0-1.0
    float dimFactor = dimActive ? DIM_FACTOR : 1.0f;     // Dimæ—¶è¡°å‡åˆ°16%
    return baseLevel * dimFactor;
}
```

### OSCåè®®åœ°å€
- `/Monitor/Master/Volume` - Master Gainæ§åˆ¶ (0-100%)
- `/Monitor/Master/Dim` - Dimå¼€å…³æ§åˆ¶ (0/1)

**v4.1åœ¨v4.0åŸºç¡€ä¸Šå®Œç¾å®ç°äº†Master Bus Processorç³»ç»Ÿï¼Œä¸ºä¸“ä¸šç›‘å¬æ§åˆ¶æä¾›äº†å®Œæ•´çš„æ€»çº¿æ•ˆæœå¤„ç†èƒ½åŠ›ï¼** ğŸ›ï¸âœ¨