# 1. 项目概述

## 1.1 项目目标

**MonitorControllerMax (Rust Edition)** 旨在重建基于 macOS/Windows 平台的工业级监听控制器 VST3/CLAP 插件。

本项目的核心使命是**彻底根除**传统 C++ 音频开发中常见的数据竞争、内存不安全和崩溃问题。利用 Rust 语言的**所有权模型 (Ownership Model)** 和现代化的 **Workspace** 架构，构建一个数学上被证明为内存安全、并发安全的高性能音频控制系统。

## 1.2 核心特性

- 🛡️ **内存安全架构**：基于 Rust Module System 的严格所有权管理，彻底消除空指针和悬垂指针。
- 🚀 **模块化设计 (Workspace)**：
    - **Protocol**: 纯数据协议层，确保跨线程/跨网络的数据一致性。
    - **Core**: 纯函数式音频逻辑核心，易于测试和复用。
    - **Reactor**: 统一的异步运行时，管理 Web、OSC 等副作用。
    - **Plugin**: 极薄的适配层，专注于 DAW 交互。
- 🌐 **多端协同**：
    - **Master-Slave**: 支持跨机分布式的监听控制。
    - **Web Controller**: 支持通过手机/平板浏览器远程控制插件。
    - **OSC**: 支持 Loupedeck/StreamDeck 硬件集成。
- ⚡ **无锁音频处理**：音频线程严格遵循 Real-time Safe 原则，无内存分配，无锁竞争。
- 🎨 **现代 GUI**：基于 `egui` 实现的响应式界面，支持高 DPI 和动态缩放。

## 1.3 为什么要重构？

原单体 (Monolithic) Rust 版本虽然解决了 C++ 的内存安全问题，但在功能扩展时遇到了**编译时间过长**和**循环依赖**的瓶颈。通过将其重构为 Workspace 架构，我们实现了：
1.  **并行编译**：各 Crate 独立编译，显著提升开发效率。
2.  **关注点分离**：音频算法开发者无需关心网络实现，UI 开发者无需关心底层协议。
3.  **可测试性**：核心逻辑 (`mcm_core`) 不依赖任何插件 SDK，可独立进行单元测试。

## 1.4 当前状态 (2026.1)

**阶段：模块化重构完成 (Stable)**

项目已成功迁移至全新的 Workspace 架构，通过了全量编译验证。

### 核心模块
| Crate | 版本 | 描述 |
| :--- | :--- | :--- |
| `mcm_protocol` | v0.1.0 | 数据契约、配置结构、通信协议 |
| `mcm_infra` | v0.1.0 | 日志系统、配置加载器、基础工具 |
| `mcm_core` | v0.1.0 | 核心业务逻辑、音频处理算法、参数定义 |
| `mcm_reactor` | v0.1.0 | 异步任务运行时 (Tokio)，集成 Web/OSC 服务 |
| `monitor_controller_max`| v2.6.0 | 插件宿主适配层 (nih-plug)，UI 实现 |

### 已就绪功能
- ✅ **全平台构建**：Windows / macOS (:white_check_mark: 待验证)
- ✅ **构建自动化**：基于 `xtask` 的自动打包与部署流程
- ✅ **协议 v2**：支持布局切换、自动化模式同步
- ✅ **Web 控制**：内建 HTTP/WebSocket 服务器
- ✅ **OSC 集成**：支持双向 OSC 通信

### 版本信息
- **Plugin Version**: 2.6.0
- **Rust Edition**: 2021
- **Framework**: nih-plug
