# 8. 未来架构演进路线 (v3.0 Roadmap)

本文档归档了针对 MonitorControllerMax (v2.6) 的深度架构审计意见。这些建议不仅适用于本项目的持续优化，也是将本项目打磨为“工业级 VST3 通用开发模板”的行动指南。

## 8.1 依赖管理优化 (The Foundation)

### 1. 从 Vendoring 转向 Submodule
**现状**: `Library/nih-plug` 包含了魔改后的源码 (Vendoring)。
**问题**: 难以同步上游的 Bug 修复。
**行动项**:
- 创建 `nih-plug` 的 Fork 仓库。
- 使用 `git submodule` 将其挂载到 `Library/`。
- 将所有修改（如 GUI 句柄适配）提交为 Patch 或 Branch。
- **价值**: 让使用者清晰地看到修改边界，同时保持对上游的跟进能力。

### 2. 资源编译内嵌
**现状**: 字体、图片等资源散落在源码目录，依赖 `xtask` 拷贝。
**行动项**:
- 使用 `include_bytes!` 宏将关键静态资源直接编译进 DLL 二进制中。
- **价值**: 彻底根除“安装后资源丢失”或路径解析错误的问题，提升部署稳健性。

## 8.2 极致的实时安全性 (Real-time Purity)

这是区别业余插件与顶级插件的核心指标。

### 1. 强制零分配 (Zero Allocation)
**现状**: `mcm_core` 逻辑尽量避免了分配，但缺乏强制保障。
**行动项**:
- 引入 `assert_no_alloc` crate。
- 在 Debug 模式下的音频线程回调中启用检查，一旦检测到堆分配（如 `format!`, `Vec::push`）直接 Panic。
- **价值**: 数学上证明音频处理过程不会因 GC 或内存碎片整理而产生爆音。

### 2. 通信模型升级 (Triple Buffer / RingBuffer)
**现状**: 使用 `crossbeam::channel` 进行线程间通信。
**行动项**:
- **参数更新 (UI -> Audio)**: 引入 **Triple Buffer (三缓冲)** 机制。保证音频线程永远能无锁、无等待地获取最新的参数快照。
- **事件流 (Audio -> UI)**: 使用 **SPSC RingBuffer** (如 `rtrb`) 替代 Channel，进一步降低微小的锁竞争风险。

## 8.3 泛化与模板化 (Generalization)

要让本项目成为通用的 Rust VST3 模板，必须剥离具体的业务逻辑。

### 1. 提炼 DspAlgorithm Trait
**现状**: `channel_logic` 和 `audio_processor` 深度耦合了监听控制器的具体业务（如 Dim/Cut/SpeakerLayout）。
**行动项**:
- 定义通用的 `DspAlgorithm` Trait：
  ```rust
  pub trait DspAlgorithm: Send {
      fn process(&mut self, buffer: &mut AudioBuffer, context: &ProcessContext);
      fn handle_event(&mut self, event: Event);
  }
  ```
- 将 `MonitorController` 的逻辑作为该 Trait 的一个实现。
- **价值**: 开发者只需实现该 Trait 即可利用这里的整套架构（GUI、OSC、Web、Xtask），无需修改核心框架代码。

## 8.4 Web 交互性能突破

### 1. 二进制协议与共享内存
**现状**: Webview 通信使用 JSON 序列化。
**瓶颈**: JSON 在处理高频数据（如 60FPS 电平表、频谱图）时会产生大量 GC 和 CPU 开销。
**行动项**:
- **协议层**: 从 JSON 迁移到 `bincode` 或 `FlatBuffers`。
- **传输层**: 探索 Shared Memory (WASM) 方案，让 Web 端直接读取音频分析数据，跳过消息传递。
- **价值**: 实现如 FabFilter 般丝滑的 60FPS Web 可视化界面。

## 8.5 总结

MonitorControllerMax v2.6 已经建立了一个坚实的 Workspace 模块化架构。上述演进路线将在此基础上，将其推向**极致性能**和**通用性**的巅峰。

> **当前的架构已经赢在了起跑线，接下来的工作是让它飞起来。**
