# 6. 开发路线图 (Roadmap) - 重大修订

原有的“四周开发时间线”是基于项目初期的理想化预估，第一阶段的实践证明该计划已不符合项目实际情况。现根据当前已取得的进展和对技术挑战的更深刻理解，废除旧计划，更新为以下更具现实意义的开发路线图。

本路线图以**里程碑**为导向，而非僵化的时间点。

---

## ✅ 阶段一：GUI 基础设施构建 (已完成)

**目标**: 验证 `nih-plug` + `egui` + `wgpu` 技术栈的可行性，并构建一个可缩放、不拉伸的 GUI 底座。

**已交付成果**:
- 1. **稳定的渲染后端**：成功集成 `wgpu`，解决了与宿主窗口的兼容性问题。
- 2. **可靠的 UI 缩放**：攻克了 `nih-plug-egui` 的缩放机制，实现了 DPI 感知的动态缩放。
- 3. **基础 GUI 原型**：已能正确渲染出如 `image.png` 所示的初步界面，为后续功能开发扫清了最大的底层技术障碍。
- 4. **沉淀了核心开发经验**：完成了《第一阶段开发经验总结》，将遇到的坑和解决方案转化为团队的技术资产。

---

## ➡️ 阶段二：核心业务逻辑迁移与实现 (当前阶段)

**目标**: 将 C++ 版本的核心监听控制逻辑，安全、完整地迁移到 Rust 中，并与 `nih-plug` 的参数系统深度集成。**此阶段暂时不要求 UI 完美**，重点是内在逻辑的正确性。

**核心任务**:
- [ ] **参数系统定义 (`Params`)**: 在 `lib.rs` 中，使用 `nih-plug` 的 `FloatParam`, `BoolParam`, `EnumParam` 等，完整定义出插件所需的所有可控制状态（如 Master Gain, Channel Mute/Solo, Solo Mode 等）。
- [ ] **语义状态机实现 (`SemanticState`)**: 编写纯逻辑的 `ChannelLogic` 模块，实现 Solo-In-Place, Solo-In-Front, PFL 等各种 Solo 模式下的 Mute 状态计算逻辑。
- [ ] **单元测试覆盖**: 为 `ChannelLogic` 编写全面的单元测试，模拟各种复杂的 Solo/Mute 组合，确保其行为与 C++ 版本的功能真值表 100% 一致。
- [ ] **逻辑与参数的打通**: 将 `Params` 作为 `ChannelLogic` 的输入，使其能根据参数变化计算出正确的 `RenderState`。
- [ ] **音频处理应用**: 在 `AudioProcessor` 中，应用 `RenderState` 的计算结果，实现对音频信号的增益控制。

**验收标准 (里程碑 M1 - Logic Core)**:
- 可以在宿主中通过**改变插件参数**（例如，在 Reaper 的参数控制面板中手动打开 Channel 3 的 Solo），能够通过录音验证其他通道被正确地静音了。此时，我们自己的 GUI 可能还只是一个占位符。

---

## 🕒 阶段三：UI 功能的全面实现

**目标**: 将已经验证正确的业务逻辑，与我们的 `egui` 界面进行全面对接，实现一个功能完备、交互流畅的用户界面。

**核心任务**:
- [ ] **路由矩阵绘制**: 使用 `egui::Painter` 或其他高效方式，绘制出 18x18 的路由矩阵，并能响应用户点击，更新对应的路由参数。
- [ ] **控件与参数绑定**: 将界面上的所有旋钮、按钮、开关，与 `Params` 系统中定义的参数进行双向绑定。
- [ ] **动态布局**: 根据插件当前的通道数配置，动态生成对应的通道条 (Channel Strip)。
- [ ] **右键菜单与配置**: 实现右键菜单功能，用于进行通道分组、命名等高级配置。

**验收标准 (里程碑 M2 - Functional UI)**:
- 所有在 C++ v4.1 版本中可见的 UI 功能均已实现。用户可以通过操作 GUI 完成所有监听控制任务，其效果与直接操作参数一致。

---

## 🕒 阶段四：硬件集成与性能优化

**目标**: 实现与 Loupedeck/StreamDeck 等外部硬件的 OSC 联动，并对插件进行性能分析和优化。

**核心任务**:
- [ ] **OSC 服务集成**: 编写 OSC 消息解析逻辑，将外部控制指令映射为对 `Params` 的更新。
- [ ] **双向同步**: 实现插件状态变更后，主动发送 OSC 消息给硬件，以更新硬件上的指示灯或屏幕显示。
- [ ] **性能分析**: 在满负载（例如 18x18 路由全开）的情况下，使用 `perf` 或 `Instruments` 等工具分析插件的 CPU 占用率。
- [ ] **代码优化**: 针对性能瓶颈（如果存在），进行针对性的优化，特别是在 DSP 线程和 GUI 渲染部分。

**验收标准 (里程碑 M3 - Release Candidate)**:
- 硬件控制功能稳定可靠。
- 在主流配置的机器上，满负载运行时 CPU 占用率低于一个可接受的阈值（例如 1%）。

---

## 🕒 阶段五：文档、打包与发布

**目标**: 完成最终的用户文档，并打包发布 v5.0 (Rust Edition)。

