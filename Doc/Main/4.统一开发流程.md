# 4. 统一开发流程

本文档定义了从 C++ 迁移到 Rust 的标准化作业流程。

## 4.1 IDIV 开发循环

我们沿用 IDIV (Iterative Design, Implement, Verify) 模式。

### 1. 逻辑设计 (Design)
*   明确输入（Params, OSC）、处理（Semantic Logic）、输出（RenderState）。
*   参考《MonitorControllerMax 核心逻辑与交互设计规范 (v4.0)》进行推演。

### 2. 代码实现 (Implement)
*   优先实现纯逻辑模块 (`ChannelLogic`) 并编写单元测试。
*   实现网络层 (`NetworkManager`)，确保数据包的序列化/反序列化正确。
*   最后集成到 `AudioProcessor`。

### 3. 验证 (Verify)
*   **单元测试**: 覆盖所有 Solo/Mute 组合的真值表。
*   **集成测试**: 在 DAW 中加载 Master 和 Slave，验证音频流是否符合预期。
*   **网络测试**: 在两台电脑上分别运行 Master 和 Slave，验证跨机控制。

## 4.2 构建与调试命令

使用 `xtask` 进行跨平台构建和打包。

```bash
# 构建 VST3 并自动安装到系统目录
cargo xtask bundle monitor_controller_max --release

# 仅运行单元测试
cargo test -p monitor_controller_max
```

**调试提示**: 由于涉及多实例网络通信，建议使用 Wireshark 或类似工具抓包验证 ZMQ 数据流。

## 4.3 迁移 Checklist

- [ ] 数据结构是否使用了 `Arc/RwLock` 替代裸指针？
- [ ] DSP 循环中是否清除了所有 `unwrap()`？
- [ ] **(网络)** 是否处理了 ZMQ 的非阻塞接收？
- [ ] **(逻辑)** 是否实现了 v4.0 规范中的所有 Solo/Mute 规则？
- [ ] **(GUI)** 是否所有尺寸都使用了 `scale.s()` 进行处理？
