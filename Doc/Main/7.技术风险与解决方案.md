# 7. 技术风险与解决方案 (经实践验证与更新)

## 7.1 风险矩阵

| 风险项 | 状态 | 可能性 | 严重性 | 描述 | 解决方案 |
| :--- | :--- |:---|:---|:---|:---|
| **GUI 框架兼容性** | <font color="green">**已解决**</font> | 低 | 高 | `egui` + `glow` 兼容性问题。 | **已解决**：切换至 `wgpu` 后端。 |
| **网络延迟与丢包** | <font color="orange">**设计解决**</font> | 低 | 中 | 跨机通信导致操作滞后。 | **方案**: 采用 ZMQ PUB/SUB + TCP。局域网延迟通常 <1ms。状态保持机制解决了丢包带来的“状态跳变”风险。 |
| **Master 故障影响** | <font color="green">**已解决**</font> | 低 | 极高 | Master 崩溃导致系统全开爆音。 | **已解决**: 将 Gain/Dim 控制权下放给 Slave。Slave 具备“状态保持”特性，Master 挂掉时 Slave 维持原状。 |
| **OSC 端口冲突** | <font color="red">**待处理**</font> | 高 | 中 | 端口占用。 | **计划中**: 提供端口配置选项。 |

## 7.2 核心问题与已验证的解决方案

### 7.2.1 根除“死亡指针” (The Weak Ref Pattern)
通过 Rust 的所有权机制和 Registry 模式解决。

### 7.2.2 分布式状态同步 (The ZMQ Snapshot Pattern)
**旧方案**: 进程内指针/共享内存。不支持跨机。
**新方案 (v4.0)**: **ZMQ PUB/SUB + Bincode**。
*   **Master**: 广播序列化后的 `RenderState`。
*   **Slave**: 后台线程接收并更新 `AtomicCell` 缓存。DSP 线程无锁读取。
*   **优势**: 天然解耦，支持跨机，自动重连，状态保持。

### 7.2.3 复杂 Solo 逻辑的解耦 (The Logic Core)
通过 `ChannelLogic` 纯函数模块，实现了 v4.0 规范中极其复杂的“混合 Solo”、“SUB 豁免”、“A/B 对比”逻辑。逻辑与 UI、DSP 完全分离，确保了可测试性和稳定性。
