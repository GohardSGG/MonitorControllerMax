# 3. 项目规范与约定

本文档定义了 MonitorControllerMax (Rust Edition) 的开发规范。

## 3.1 核心原则 (The Iron Rules)

1.  **No Raw Pointers (拒绝裸指针)**: 严禁使用 `*const T` 或 `*mut T`。
2.  **Allocation-Free DSP (DSP 零分配)**: 音频线程严禁内存分配。
3.  **Panic Free (拒绝崩溃)**: 运行时逻辑必须处理所有 `Result`。
4.  **Fail-Safe (故障导向安全)**: 在网络断连、Master 崩溃等异常情况下，Slave 必须保持当前状态或平滑静音，严禁产生全量爆音。

## 3.2 目录与文件命名规范

*   **Rust 源文件**: 必须使用 `snake_case` (e.g., `lib.rs`, `audio_processor.rs`)。
*   **目录**: 保持 `PascalCase` 以进行逻辑分组。

## 3.3 Rust 代码风格规范

| 条目 | 风格 | 示例 | 备注 |
| :--- | :--- | :--- | :--- |
| **结构体/枚举** | `PascalCase` | `RenderState`, `NetworkPacket` | Rust 标准 |
| **变量/函数** | `snake_case` | `process_audio`, `broadcast_state` | Rust 标准 |

## 3.4 注释规范

**所有代码注释必须使用中文 (Chinese Simplified)。**

## 3.5 GUI 实现规范

*   **渲染后端**: **必须**使用 `wgpu`。
*   **缩放机制**: **必须**通过 `set_scale_factor_override()` 管理。
*   **尺寸计算**: **严禁**硬编码像素，必须使用 `scale.s()`。
*   **状态管理**: UI 控件仅作为 `Params` 的视图，不存储业务状态。

## 3.6 网络通信规范 (新增)

*   **端口约定**: 默认使用 `9123` (ZMQ) 和 `9124` (OSC)。
*   **序列化**: 必须使用 `#[repr(C)]` 标记网络结构体，确保内存布局稳定。
*   **线程模型**: 网络 IO 必须在独立的后台线程中运行，严禁阻塞 GUI 或 DSP 线程。

## 3.7 构建输出规范

构建脚本 (`xtask`) 必须具备错误阻断机制：如果编译或打包失败，后续的拷贝流程**绝不能**执行。
